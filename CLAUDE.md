# Claude Code 開発履歴とコンテキスト

このファイルは、Claude Codeとの開発セッションの履歴と、プロジェクトのコンテキストを記録するためのものです。

> 📐 **システム設計の詳細は[ARCHITECTURE.md](ARCHITECTURE.md)を参照してください**

## プロジェクト概要

**目的**: MetaTrader 4用の裁量トレード支援ツールの開発
**開発者**: kapistock365
**開始日**: 2025年1月
**最終更新**: 2025年1月（プラグインアーキテクチャ実装）

## 開発フェーズ

### Phase 1: 初期開発（完了）
- 個別機能のEA/インジケーター作成
- 既存ライブラリの活用
- 基本的なリスク管理機能

### Phase 2: 統合アーキテクチャ（完了）
- プラグインシステムの設計・実装
- UnifiedTradingEAの開発
- 既存機能のプラグイン化

### Phase 3: 拡張開発（現在）
- 新規プラグインの追加
- パフォーマンス最適化
- ユーザビリティ向上

## 開発背景と課題

### 現在の課題
1. **トレンドフォロー**: 価格のブレイクアウトを確実に捉えたい
2. **損切り管理**: 相場が逆行した際に損切りができず、利益を失ってしまう
3. **感情的な取引**: 機械的なルールに従えない

### 解決アプローチ
- 自動化ツールによる感情の排除
- リスク管理の可視化
- 段階的な利益確保システム

## 既存資産

### CT_Trail_2.00 ライブラリ
過去に開発したEAから以下のライブラリを流用：
- `AccountManager.mqh`: 口座管理、自動ロット計算
- `OrderManager.mqh`: 注文管理、トレーリングストップ
- `GuiManager.mqh`: GUI表示管理
- `Constants.mqh`: 共通定数定義

## 開発したツール

### 1. トレンドフォロー系
- **TrendBreakout.mq4** (インジケーター)
  - サポート/レジスタンスの自動検出
  - ブレイクアウトアラート
  - ADXによるトレンド強度表示

- **TrendFollowEA.mq4** (EA)
  - ブレイクアウトでの自動エントリー
  - 既存ライブラリを活用したリスク管理
  - トレンドフィルター機能

### 2. リスク管理系
- **RiskManagerEA.mq4** (EA)
  - 全ポジションへの自動損切り設定
  - 日次損失制限（5%）
  - 部分決済とブレークイーブン機能
  - トレーリングストップ

- **RiskMonitor.mq4** (インジケーター)
  - リアルタイムリスク表示
  - 日次統計（勝率、RR比）
  - 損失制限警告

## 設計思想

### 1. モジュール化
- 既存ライブラリの再利用
- 機能ごとに独立したツール
- 組み合わせて使用可能

### 2. リスク管理優先
- 損失制限を最優先
- 段階的な利益確保
- 可視化による意識付け

### 3. 感情の排除
- 機械的なルール実行
- アラートによる客観的判断
- 自動化による迷いの排除

## プラグインアーキテクチャ（2025年1月実装）

MT4の制限（1チャート1EA）を解決するため、モジュラープラグインシステムを導入しました。

### システム構成

```
mt4-trading-tools/
├── Experts/
│   ├── UnifiedTradingEA.mq4      # 統合EA（メイン）
│   ├── TrendFollowEA.mq4         # 単体版（レガシー）
│   └── RiskManagerEA.mq4         # 単体版（レガシー）
├── Include/
│   ├── PluginBase.mqh            # プラグイン基底クラス
│   └── Plugins/
│       ├── BreakoutPlugin.mqh    # ブレイクアウトプラグイン
│       └── RiskManagerPlugin.mqh  # リスク管理プラグイン
└── CT_Trail_2.00/Include/         # 既存ライブラリ
```

### UnifiedTradingEAの特徴

1. **プラグイン管理**
   - 動的なプラグイン登録
   - ライフサイクル管理
   - イベント配信システム

2. **統合GUI**
   - メインコントロールパネル
   - プラグイン別設定パネル
   - リアルタイム情報表示

3. **共通機能**
   - 自動ロット計算
   - 基本的な注文管理
   - 口座情報管理

### 実装済みプラグイン

| プラグイン | 機能 | ステータス |
|-----------|------|----------|
| BreakoutPlugin | 価格ブレイクアウト検出・自動エントリー | ✅ 実装済 |
| RiskManagerPlugin | 自動損切り・トレーリングストップ | ✅ 実装済 |
| NewsFilterPlugin | 経済指標フィルター | 🔄 計画中 |
| GridTradePlugin | グリッドトレード | 🔄 計画中 |

> 詳細な設計は[ARCHITECTURE.md](ARCHITECTURE.md)を参照

## 今後の拡張案

1. **追加プラグイン開発**
   - ニュースフィルタープラグイン
   - マーチンゲールプラグイン
   - グリッドトレードプラグイン
   
2. **プラグイン間通信**
   - イベントシステムの実装
   - プラグイン間のデータ共有
   
3. **外部設定ファイル**
   - JSONまたはXMLでの設定管理
   - プロファイル機能
   
4. **バックテスト最適化**
   - プラグインの組み合わせ最適化
   - パフォーマンス分析

## 他のPCでの開発再開方法

1. このリポジトリをクローン
2. CLAUDE.mdを読んでコンテキストを理解
3. Claude Codeに以下を伝える：
   ```
   MT4の裁量トレード支援ツールを開発しています。
   CLAUDE.mdに開発履歴があるので、それを踏まえて開発を続けたいです。
   ```

## 重要な決定事項

- **エンコーディング**: MQL4ファイルはUTF-8で統一
- **ブローカー対応**: pips×10のブローカーに対応済み
- **リスク設定**: 1トレード最大2%、日次最大5%を推奨

## よくある質問と回答

**Q: なぜ既存ライブラリを使うのか？**
A: 実績のあるコードを再利用することで、品質と開発速度を向上

**Q: 損切りの自動化は危険では？**
A: むしろ感情的な判断による大損失を防ぐために必要

**Q: トレンドフォローの精度は？**
A: 単独では限界があるため、裁量判断と組み合わせて使用